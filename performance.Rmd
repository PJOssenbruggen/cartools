---
title: "Highway Performance"
bibliography: "CF.bibtex"
---



```{r, include = FALSE, warning = FALSE, message = FALSE, error = FALSE}
library(Basic)
```

__Highway Performance__ 

An important measure of highway performance is traffic flow, which we denote as $q$. It is the number of vehicles that pass a point in unit time. Typically, it is reported in vehicles per hour (vph).  A principal product of this effort is the development of a probability model that treats traffic flow $q$ as a random variable:

* $Q  = f(U, k, l, h)$.

$Q$  is a function of the random variable $U$, traffic density $k$, measured in vehicles per unit length, vehicle length $l$  and distance headway $h$. Additionally, $h$ is assumed to be a _safe driving distance_  that reflects the drivers aversion to risk. Since all drivers are assumed to maintain a safe headway, no crashes are permitted under the assumptions of this model. As the vehicular speed increases, the safe driving distance as defined by a  deterministic function of $u$ and $l$.  

The _fundamental relationship_,

* $q = k * u$,

defines  $q, k$ and $u$ as deterministic variables. Field test are used in this study. A radar device was used to measure the speed of each vehicle and count the number of vehicles $n$ as they pass a point along a highway over a given time interval $\tau$. The speed and flow for $\tau$ are recorded as an average speed $u$  and $q$  where $q = n/\tau$. The traffic density is estimated as $k = q/u$. All estimated values for $\tau$ are treated as constants. There were 96 recordings of $q$, $k$ and $u$ per day. It will be shown presently that these recordings are highly volatile recordings. Since they vary over the course of a day and day-by-day, why arenot all these variables treated as random variables? This question will be deferred and discussed presently. 

 

The  random variable model $Q$ is a _parsimonius, stochastic model._ 

The overall  volatility of $Q$  is assumed to be a measure of driver group dynamics and other uncertainties.  

* $U = f(u, \sigma)$


Let us get started by investigating a _traffic breakdown event_, an event that triggers the onset of congestion event. As  all drivers know from experience, the highway will be is a congested depending on how many vehicles are on the highway. The _triggering mechanism_ is the vehicle count. Some drivers may observe that a highway with seemingly the same number of the vehicles on the highway may or may not be in a congested state. Knowing the vehicle count is important but insufficien evidence in predicting the onset of congestion with _certainty._. Regardless, some drivers may alter their trip plan to avoid dealing with a congestion event or the possibility of being involved in a crash. 



 In place of a subjective analysis, field data will be collected and analyzed. To simplify the discussion, we will assume the data are collected at the same site over an extended time period, say, months. With these data, the proportion of congestion events can be estimated as $p = m/n$ where $m$ is the congestion events and $n$ is the total number of days of the study. To perform this calculation, we  define congestion as a critical speed $u^*$, a speed that separates a congested state from a free-flow (uncongested) state. The proportion $p$, a measure of performance, can be refined. Say, to estimate the performance of $p$ for rush hour traffic. For this estimate to have meaning, we must define rush hour traffic. It is defined as a time-of-day where traffic is deemed to be "heavy."  It is measured  as a  traffic flow $q$ in vehicles per hour (vph). $q = n/\tau$ where $n$ is a vehicle count over time period $\tau$. The rush hour speed, in actually, is an average speed of the $n$ vehicles observed over the 15-minute time period. The rush hour speed $u$ and flow $q$ are aggreates. 

The estimates of $p$, whether it is estimated with daily or hourly count data, and $q$ are measures of _past performance_. Our transportation operation and management plan deals with the _future._ By necessity, the probability of a traffic breakdown event, $\pi = P(U < u^*)$ will replace $p$ and the random value $Q$ will replace $q$. Since highway geometry or some other improvement will be made,  $\pi$ and $Q$ models must be carefully selected and model parameters estimated.

To make reliable predictions a reality, _the root cause of a traffic breakdown must be identified and understood_. The so-called  __Ring Road Experiment__ conducted by  @1367-2630-10-3-033001 is _a  controlled experiment_ that brings insight to the complex nature of identifying what triggers traffic breakdown. 

This experiment differs fundamentally from the field study described above. Here, $n$, the number of vehicles over the duration of the study, was fixed. Next, these vehicles were driven around a loop road  where no vehicles were allowed to enter or exit. Finally, the drivers were instructed to maintain a constant speed $u$ and constant safe headway $h$.  The YouTube video, https://www.youtube.com/watch?v=7wm-pZp_mi0, shows the drivers were unable to follow these simple  instructions. The volatility in speed, denoted as $\sigma$ and called _traffic noise_ explains the result. An added bonus of this experiment it allows the process to be described by a simple probability model of $U$.  

Finally, highway bottlenecks and traffic merging were analyzed using field data. The speed data were treated as time-series data and placed in bins according the number of speed recordings observed over a stretch of 15-minutes. There are $i$ = 1,2, ..., 96 bins in a 24-hour day. The average speed for each bin is calculated and recorded as $u_1, u_2, ..., u_{96}$; the number of speed observations by bin sample size, $n_1, n_2, ..., n_{96}$, are recorded; and the traffic flows $q_1, q_2, ..., q_{96}$ are estimated as $q_i = n_i/\tau$ where $\tau$ equals 15-minutes. With the aid of the fundamental relationship $q = k * u$, the traffic density $k_i = q_i/u_i$ can be determined. Visual inspection, scatter plots, etc., of the $q_i$, $k_i$ and $u_i$ help explain traffic breakdown and highway performance.   including the use of computer simulation and animation are used to increase understanding of complex traffic behavior. 






A principal product of this effort is the development of a probabilistic traffic flow model:

* $Q  = f(U; k, h)$

where speed is treated as a random variable $U = g(u, \sigma)$ where speed $u$, the standard deviation of speed $\sigma$,  traffic density $k$,  and safe headway $h$ are  constant values.  The overall  volatility of the process  is specified by $\sigma$, which is assumed to be a measure of driver group dynamics and other uncertainties.  The   _safe distance headway_  $h$  reflects the drivers aversion to risk. Additionally,  $h$ is assumed to be a _deterministic_ function of the constant speed $u$ and vehicle length. Since all drivers are assumed to maintain a safe headway, no crashes are permitted.  Thus, the model of $Q$ is an important measure of highway performance and a _parsimonius, stochastic model._ 



Since $n$ is fixed and speed varies over time and is treated as a random variable $U$, the fundamental relationship is written as $Q = nU/l$ where the road length is $l = 2\pi r$ with $r$ equal to the radius of the loop road. Returning to the question of the better model, $\pi = P(Q = q)$ or $\pi = P(K = k)$, the answer is $\pi = P(U = u)$. The _root causes of traffic breakdown_ in this experiment are: (1) the inability of the drivers to maintain a constant speed, and (2) the drivers need to accelerate and decelerate to maintain a safe distance between themselves and the vehicles in front of them or safe headways. The _optimum driving condition_ is defined to be time it takes an indivual driver to complete a loop at speed $u$. The delay is estimated as the extra time for a driver to complete a loop. To explain this scenario, the stationary time-series model of $U$ is introduced and the calibration of this model is discussed. 


No question that designing and operating a transportation system are difficult problems. By disecting the problem into manageable pieces and synthesizing the  results from the individual pieces brings clarity to the process. 

__Traffic Noise__ 

A quick read of the __Overview__ may give the impression that the approach, a package of computer algorithms, will be difficult to understand and overwhelming to implement. Words, like complex, dynamics, theory, parsimonious, stochastic and model integration can be daunting. No question that designing and operating a transportation system are difficult problems. By disecting the problem into manageable pieces and synthesizing the  results from the individual pieces brings clarity to the process. 


The mathematics behind the animation is relatively simple. Of course, the Brownian motion model shown here can be adapted to other situtations. This will be  illustrated presently. The ultimate aim of using [trfhp](https://github.com/PJOssenbruggen/Basic) package tools is to improve our chances of mitigating congestion and improving performance using the simple mathematical and graphical tools.




__Traffic Flow__

Since $n$ is a constant, $k = n/2\pi r$ is a constant. The flow is a random variable, defined as:

* $Q(t) = k * U(t)$

The volatility in $Q(t)$ is explained exclusively by the volatility in $U(t)$ as defined by the Brownian bridge model of speed.  

__Summary__
    
The $Q(t) = k * U(t)$ model suggests a _cause-effect relationship_ exists. The speed as specified by  $u$ and $\sigma$ are the causal factors and  $Q(t)$ is the response variable. The probability of being in a congested state is forecast to be a function of $k$, $\pi(k)$. 


__Theory__

Exploratory data analysis showed the traffic on I-93 in Salem to be extremely volatile and the chance of traffic breakdown is strong. Given these observations, it is natural to express the _fundamental relationship_ of traffic flow as $Q = K * U$ where $Q$, $K$ and $U$ are assumed to be random variables. However, the results of the ring-road experiment gave evidence that the variability in $Q$ depends wholly on the variability in speed, which we assumed to be a Brownian motion model $U(t)$. The argument was simple. Since the number of vehicles on the road $n$ and road length $l$ are constants, it follows that the density must be a constant.  Since $k = n/l$, $Q = k * U(t)$.  Our conclusions were derived from watching a short video and assuming flow, density and speed are measured on a time scale in seconds. 

The argument for the  $Q = K * U$ model is based upon _macroscale_ observations or averages of flow, density and speed derived from 15-minute averages. In contrast, the argument for the  $Q = k * U(t)$ model is based upon assuming variables are measured on the _microscale_. Certainly, the simpler  $Q = k * U(t)$ model is the model of choice for  bottleneck breakdown because we can envision why driver behavior can trigger a breakdown. The vehicles must merge at a bottleneck. In addition, many drivers, who drive this roadway on a regular basis, weave from one lane to another. Drivers in the NH and MA are known for their aggressiveness. By being so aggressive, they increase the traffic volatility by abruptly accelerating and decelerating. The $CF$ approach is a tool can be refined to study aggressive driver behavior. 

To justify the  $Q = k * U(t)$ model for a bottleneck, consider a "thought experiment." In addition to collecting speed $u_i$ data that we described above for the eight  month I-93 study, a series of videos are simultaneously taken by a helicopter flying overhead or by a drone. The video data will be used to obtain direct measures of density  $k_i = n_i/l$.  Next, take the matched $k_i$ and $u_i$ records, sort them into bins according to magnitude of traffic density, and construct a box plot. This sorting procedure treats the density data as fixed values or constants and the speed data as a random variable.

The box plot will arguably resemble of  the __Box Plot of Density-Speed__ diagram of I-93 study data presented above in the __Exploratory Data Analysis__ section. Assuming the "thought experiment" and I-93 study data sufficiently similiar, inferences can be drawn from I-93 box-plot. By visual inspection, speed decreases as the traffic density increases. Since the bottleneck geometry is unchanged throughout the experiment, the number of vehicles $n_i$ and speed $u_i$ are strongly associated. Thus, the $Q = k * U(t)$ model holds. 

To be absolutely clear about the meaning of the $Q = k * U(t)$ model for the Brownian motion speed model, $U(t) = u + \sigma W(t) = u + \sigma \sqrt{\Delta t} Z$, we rewrite it in functional form to draw attention to the _key variables_:

* $Q = f(k, u, \sigma, h)$

where $k = n/l$ = traffic density, $u$ = design speed,  $\sigma$ = standard deviation of $u$, and  $h$ represents a safe headway for vehicles of the same length.    

__Forecasting__

Inspecting $t-x$ trajectories and $h$ histograms derived from the $Q$ model  proves to be an effective in understanding traffic breakdown and explaining being in a congested state. Given $k$, it is possible to predict  probability of traffic breakdown  $\pi$. To gain an appreciation of the  $\hat{\pi}$ forecast model, look at the  __Box Plot of Density-Speed__ diagram.  We select bin of $k$ and then determine the proportion of breakdowns $p$ in the bin.  $p$ is straightforwardly calculated as the ratio of the number of observations where $u \le u^*$ to the total number of observations in the bin $k$. As previously mentioned, the HCM designates roadway capacity $c^*$ to be in the vicinity 2250 vph  at $k^*$ = 45 vpm. The estimate of $p$  for this bin is quite small. However, as  the $k$ values increase, the values of $p$ increase rapidly. Expressing $\pi$ by _time-of-day_ we have a wortwhile tool, _a macroscale model_, that traffic operators and managers may find useful:

$\hat{\pi} = P(K_t \ge k^*)$ 

$K_t$ is a stochastic differential equation model of traffic density by _time-of-day_ $t$ [@pjo2017](https://github.com/PJOssenbruggen/Basic/blob/master/doc/IEEE_MT-ITS.pdf).  Treating traffic density $K_t$ as the random variable  may seem contradictory given the discussion about the $Q = k * U(t)$ model. It is not. Note that two models are different. One is a _macroscale_ model predicting breakdown and the other one is a _microscale_ model predicting flow.  

__Lessons Learned__

_What have we learned about traffic performance using the __tfuhp__ package?_ The most notable lesson learned is:

* By modeling driver behavior with a simple, parsimonious  Brownian motion model of speed, it is possible to explain and forecast  traffic  breakdown on a ring-road and at a bottleneck.  

The potential of the __tfuhp__ package as a learning tool has been demonstrated. Hopefully, this platform can be adapted and expanded to help users  identify the root cause or causes for other congestion problems. My next task is add __R Markdown Shiny__ HTML widgets to my code. Adding this feature will allow the user to simply conduct sensitivity analyses on-line. For example, the effects of speed  and density on ring-road performance can be explored. Sliders for $u$, $\sigma$ and $k$ will be provided so a user change them at will. The __tfuhp__ package will instantaneously produce a histogram of headways as illustrated above.

This package is open to the public, https://github.com/PJOssenbruggen/Basic. In other words, I am inviting people to share their experiences with the package with me. GitHub promotes this activity, https://github.com/explore.



 ```{r, echo = FALSE, fig.height = 4, fig.width = 6, message=FALSE, error=FALSE, warning = FALSE}
set.seed(123)
cflist <- run(10, 63, 10, 34, 0.1, 55, 5, 15, 14, c(0, 60), c(-2000, 5000))
title("Breakdown", "Bottleneck")
```

Over the time range of 60 seconds, the speed reduction in the lead vehicle forces the following vehicles to become more closely spaced. All drivers keep a safe headway, one vehicle length for each 10 mph of speed. The $t-x$ trajectory of the ten vehicles shown in the figure give the impression that the vehicles arrive with the same speed and headway. In fact, this is not the case:

``` {r, echo = FALSE, message=FALSE, error=FALSE, warning = FALSE}
mat <- cflist[[2]]
mat <- round(mat,0)
df  <- data.frame(mat)
colnames(df) <- c("Vehicle", "Speed at t0", "Speed at t3",   "Density at t1")
knitr::kable(df, caption = "Traffic Characteristics", align = "c")
```
    
The level-of-service estimates are:

  |Mean headway $\bar{h}$ | Headway standard deviation $\hat{\sigma}_h$ |Estimated flow $\bar{q}$ |
  |-----------------:|-------------------:| -----------------:|
  | 6.7 seconds | 20 seconds | 537 vehicles per hour (vph)|