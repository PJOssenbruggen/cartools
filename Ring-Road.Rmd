---
title: "The Ring-Road Experiment"
bibliography: "CF.bibtex"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r, include = FALSE, warning = FALSE, message = FALSE, error = FALSE}
library(Basic)
```

__A Controlled Experiment__

We continue our model building effort by simulating conditions observed on a  _ring_ or _loop road_. The [YouTube video](https://www.youtube.com/watch?v=7wm-pZp_mi0) shows $n$ = 22 vehicles [@1367-2630-10-3-033001].  The drivers cannot pass one another or enter or exit the loop.  Each driver was instructed to maintain a same constant speed $u$. The drivers cannot follow instructions. After a few sections, the traffic breaks down. 

Why? The video shows the vehicles to traveling at a reasonable speed. Initially, all vehicles are uniformly distributed around the circle. After a few seconds,  the vehicles begin to interact because the drivers cannot maintain a constant speed. If we track a vehicle, we can see the speed will vary by a slight amount. Since their no room to move laterally, the drivers must follow and react to the situation directly in front of them. 

This behavior is a classic definition of  _car-following._ The spacing between between vehicles, while it appears to be sufficient, is not. If other words, the traffic density $k$ is sufficiently large to cause the vehicles to interact, thus driving in a _congested state_. If there were fewer vehicles, i.e., driving in a _free-flow state_, then an individual driver could adjust his or her vehicle without affecting the vehicle behind it.  

__A Brownian Bridge Model of Speed__

Can we explain this behavior mathematically? Consider the following approach:

First, assume  the speed of a vehicle to be the random variable $U(t)$ and assume the process is defined by a stationary time-series model of the  form: 

* $U(t) =  u + \sigma Z$ 

where $u$ is the assigned speed as specified by the experiment and $\sigma$ is a standard deviation of speed, $Z  \sim N(0,1)$ is a standard normal probability distribution and time $t$ is measured in seconds.  

The next question is how do we assign the model parameters? It is clear that $u$ is the assigned experiment speed but what is its magnitude?  The box plot of speed-density  from our exploratory analyses  showed a connection of speed and density.  The following density-speed plot is a cleaner version of the box plot. 

```{r density-speed,  message = FALSE, fig.height = 5, fig.width = 10, echo = FALSE}
output <- uk_sdk(QUKtdayX)
```

The traffic density $k$ is controlled by the number of vehicles on the road $n$ and ring-road radius $r$:

* $k = n/2\pi r$

Knowing $k$, select $u$ and $\sigma$.


Assigning $u$ and $\sigma$ are not clear-cut as originally envisioned. For one, $U(t)$ is a _microscale model_ where driver reaction takes place on a time-scale of seconds and  the density-speed plot is a _macroscale model_ derived from 15-minute average data or $\tau$ data.  The scales are incompatable.

Second, the stationary time-series $U(t)$ model does not adequately explain driver behavior. Define the time-step equal to $\Delta t = t_i - t_{i-1}$ and for purposes of illustration, let $\Delta t$ = 1 second.  Given $Z$ takes on both positive and negative values, a simulation can predict vehicle speeds  flip-flopping back and forth from one second to the next. Obviously, a normal driver does not drive sporatically as described by the model. This flaw is rectified by replacing the $\sigma Z$ term with a Brownian motion term or:

* $U(t) = u + \sigma \sqrt{\Delta t} Z = u + \sigma W(t)$.

$W(t) = \sqrt{\Delta t} Z$ term defines Brownian motion and is called the Wiener process. A driver will more smoothly accelerate or decelerate but without limit. Over an extended period of time, say $\tau$ = 15 minutes, speeds can reach extraordinary high or low speeds (negative traveling backwards) with this model. Of course, this is another unacceptable model. 

This problem is overcome by replacing $W(t)$ with a Brownian bridge model:

* $U(t) = u + \Lambda (W(t) - t/\tau * W(\tau))$,

as the following diagram illustrates for "Congested Flow at HCM Capacity" (HCM = Highway Capacity Manual) and "Heavly Congested" simulations for two $k$ assignments. After time $\tau$ = 15 minutes, the model forces a driver to travel at speed $u$ when $\tau$ = 15 minutes. 

```{r bridge,  message = FALSE, fig.height = 5, fig.width = 10, echo = FALSE}
par(mfrow = c(1,2))
set.seed(124)
u0 = 41
usd = 11
k0 = 50
output1 <- usdBBridge(41, 11, 900, 15, 0.75)
title("","Congested Flow at HCM Capacity")
mtext(bquote(u == .(u0)), side = 3, line = 1)
mtext(bquote(hat(sigma) == .(usd)), side = 3)
mtext(bquote(k == .(k0)), side = 4)
set.seed(124)
output2 <- usdBBridge(18.8, 3.9, 900, 15, 0.5)
u0 = 18
usd = 4
k0 = 100
title("","Heavily Congested Flow")
mtext(bquote(u == .(u0)), side = 3, line = 1)
mtext(bquote(hat(sigma) == .(usd)), side = 3)
mtext(bquote(k == .(k0)), side = 4)
```

Finally, there is a  need for  $\Lambda$, the correction factor. If $\Lambda$ is assigned the value of 1, then the model can predict more volatile traffic speeds than shown here. By volatile the speeds can fall well outside its 95% confidence interval. The assignment of $\Lambda$ used an ad hoc, subjective procedure. A series of simulations for a given  $\Lambda$. If two many simulations fell outside the 95% CI, it was adjusted until was felt to be representative of the situation being simulated.

The $U(t)$ model, a mechanistic model, _explains_ driver behavior. A driver will travel at a speed in the neighborhood of $u$ over the time period from 0 to $\tau$ = 15 minutes as common sense tells us. 

__Time-Distance Trajectories__

The $U(t)$ model was subject to another test. Does the model predict driver behavior that is similar to that shown in the YouTube video?  A same instructions given to the drivers of the Yuki Sugiyama experiment are assumed for the computer simulation that produced the following $t-x$ trajectories. The drivers are instructed to maintain a constant speed $u$ and headway $h$.  The vehicles are evenly placed along the $x$ axis at $t$ = 0.  

```{r ringroad1,  message = FALSE, fig.height = 5, fig.width = 10, echo = FALSE}
set.seed(124)
par(mfrow = c(1,2))
k0 <- 50
d <- 22/(pi*k0)
d <- round(d,1)
output1 <- rrtrials(41, 11, 50, 120, 120, 14, 0.75, 10, c(0,120), c(-1000, 7500))
title("","Congested Flow at HCM Capacity")
mtext(bquote(k == .(k0)), side = 4)

h1 <- output1[[5]][1]
hsd1 <- output1[[5]][2]
q1 <- output1[[5]][3]
set.seed(124)
k0 <- 100
d <- 22/(pi*k0)
d <- round(d,1)
output2 <- rrtrials(18.8, 3.9, 100, 120, 120, 14, 0.5, 10, c(0,120), c(-500, 3500))
title("","Heavily Congested Flow")
mtext(bquote(k == .(k0)), side = 4)
h2 <- output2[[5]][1]
hsd2 <- output2[[5]][2]
q2 <- output2[[5]][3]
```

As in the full-scale experiment, the simulated drivers cannot maintain a constant speed or even spacing. After a few seconds, the vehicles begin to interact and form clusters (moving queues) and the traffic breaks down.  _Clearly, traffic volatility plays an important role._
 
__Highway Safety__

The $U(t)$ model incorporates two important features: (1) _driver performance in a car-following situation_ and (2) _safety_. All drivers are assumed to maintain a _safe driving distance_ when driving in the congested or free-flow states or

* $h_{safe} = f(u)$, 

which depends on the vehicle speed $u$. The safety effects are most easily explained with the use of the dotted  lines shown in the figures above. The dotted straight line is the trajectory of  the lead vehicle, assuming that its driver could maintain a constant speed. Since $x = u * t$, the slope of the dotted straight line is $u$. Consider a pair of vehicles, one designated as a _leader_ and the other one designated as a  _follower_. At each time-step, the locations and speeds of the lead and following vehicles and the headway between the two vehicles are calculated. If there is a safe headway violation, the following vehicle locations and speeds are adjusted to eliminate the violation. If the lead vehicle slows, the following vehicle  must slowdown to avoid a crash if too close. Under a less dense condition, the drivers can vary their speeds without affecting one another. 

__Traffic Flow__

Since $n$ is a constant, $k = n/2\pi r$ is a constant. The flow is a random variable, defined as:

* $Q(t) = k * U(t)$

The volatility in $Q(t)$ is explained exclusively by the volatility in $U(t)$ as defined by the Brownian bridge model of speed.  

__Summary__
    
The $Q(t) = k * U(t)$ model suggests a _cause-effect relationship_ exists. The speed as specified by  $u$ and $\sigma$ are the causal factors and  $Q(t)$ is the response variable. The probability of being in a congested state is forecast to be a function of $k$, $\pi(k)$. 



__Reference__